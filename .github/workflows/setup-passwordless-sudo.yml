name: Setup Passwordless Sudo

on:
  workflow_dispatch:

jobs:
  setup:
    name: Configure Passwordless Sudo
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ”§ Setup Passwordless Sudo for mdclodging user
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            echo "ðŸ”§ Configuring passwordless sudo for mdclodging user..."

            # Create sudoers file for mdclodging user
            echo "mdclodging ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/mdclodging

            # Set correct permissions
            sudo chmod 0440 /etc/sudoers.d/mdclodging

            echo "âœ… Passwordless sudo configured successfully!"
            echo ""
            echo "Testing sudo access..."
            sudo whoami

            echo ""
            echo "âœ… Setup complete! The mdclodging user can now run sudo without a password."

      - name: âœ… Setup Complete
        if: success()
        run: |
          echo "âœ… Passwordless sudo has been configured"
          echo "You can now run the Fix Production Deployment workflow"
