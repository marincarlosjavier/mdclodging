name: Fix Server with Sudo

on:
  workflow_dispatch:

jobs:
  fix:
    name: Remove Nginx and Update Code
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”§ Fix Server with Sudo
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /opt/mdclodging

            echo "ğŸ§¹ Removing nginx folder with sudo..."
            sudo rm -rf nginx/

            echo ""
            echo "ğŸ“¥ Fetching latest code..."
            git fetch origin

            echo ""
            echo "ğŸ”„ Resetting to origin/master..."
            git reset --hard origin/master

            echo ""
            echo "âœ… Server updated successfully!"
            echo "Current commit: $(git rev-parse HEAD | cut -c1-7)"
            echo "Expected commit: 1095655"

            echo ""
            echo "ğŸ“ Files changed in this update:"
            git log --oneline -5

      - name: âœ… Fix Complete
        if: success()
        run: |
          echo "âœ… Server has been fixed and updated"
          echo "The deploy script now uses git reset --hard"
          echo "Future deployments should work automatically"
